const N=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))h(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&h(c)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function h(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}};N();const W=function(e){let t;const n=()=>{window.requestAnimationFrame(n),t.update(),t.render(),h(t.changeState())},h=a=>{!a||(t=e[a[0]],t.set(a[1]))};return{setState:h,setStates(a){e=a},start(){n()},stop(){window.cancelAnimationFrame()}}},z=-1,J=18,q=!1,G=[{draworder:"topdown",id:8,name:"positions",objects:[{height:16,id:5,name:"enemy spawn",properties:[{name:"spanwPoint",type:"string",value:"enemy"}],rotation:0,type:"",visible:!0,width:16,x:496,y:48},{height:16,id:7,name:"enemy spawn",properties:[{name:"spanwPoint",type:"string",value:"enemy"}],rotation:0,type:"",visible:!0,width:16,x:0,y:48},{height:16,id:8,name:"player spawn",properties:[{name:"spanwPoint",type:"string",value:"player"}],rotation:0,type:"",visible:!0,width:16,x:48,y:240},{height:16,id:9,name:"item",properties:[{name:"spanwPoint",type:"string",value:"item"}],rotation:0,type:"",visible:!0,width:16,x:16,y:112},{height:16,id:10,name:"item",properties:[{name:"spanwPoint",type:"string",value:"item"}],rotation:0,type:"",visible:!0,width:16,x:480.666666666667,y:111.333333333333},{height:16,id:11,name:"item",properties:[{name:"spanwPoint",type:"string",value:"item"}],rotation:0,type:"",visible:!0,width:16,x:400,y:240},{height:16,id:12,name:"item",properties:[{name:"spanwPoint",type:"string",value:"item"}],rotation:0,type:"",visible:!0,width:16,x:96,y:240},{height:16,id:13,name:"item",properties:[{name:"spanwPoint",type:"string",value:"item"}],rotation:0,type:"",visible:!0,width:16,x:160,y:176},{height:16,id:14,name:"item",properties:[{name:"spanwPoint",type:"string",value:"item"}],rotation:0,type:"",visible:!0,width:16,x:336,y:176},{height:16,id:15,name:"item",properties:[{name:"spanwPoint",type:"string",value:"item"}],rotation:0,type:"",visible:!0,width:16,x:480,y:176},{height:16,id:16,name:"item",properties:[{name:"spanwPoint",type:"string",value:"item"}],rotation:0,type:"",visible:!0,width:16,x:16,y:176},{height:16,id:17,name:"item",properties:[{name:"spanwPoint",type:"string",value:"item"}],rotation:0,type:"",visible:!0,width:16,x:144,y:112},{height:16,id:18,name:"item",properties:[{name:"spanwPoint",type:"string",value:"item"}],rotation:0,type:"",visible:!0,width:16,x:352,y:112}],opacity:1,type:"objectgroup",visible:!1,x:0,y:0},{draworder:"topdown",id:9,name:"ui",objects:[{height:64,id:25,name:"left",properties:[{name:"image",type:"file",value:"../images/ui/arrow.png"}],rotation:0,type:"",visible:!0,width:64,x:16,y:208},{height:64,id:26,name:"b",properties:[{name:"image",type:"file",value:"../images/ui/button_touch.png"}],rotation:0,type:"",visible:!0,width:64,x:352,y:208},{height:64,id:32,name:"right",properties:[{name:"image",type:"file",value:"../images/ui/arrow.png"}],rotation:0,type:"",visible:!0,width:64,x:96,y:208},{height:64,id:33,name:"a",properties:[{name:"image",type:"file",value:"../images/ui/button_touch.png"}],rotation:0,type:"",visible:!0,width:64,x:432,y:208}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0},{data:[52,41,52,52,41,41,41,39,39,52,52,39,52,39,39,41,41,41,52,41,52,52,41,52,41,52,52,39,52,52,52,41,41,52,52,41,52,52,39,52,52,52,52,41,52,39,41,39,52,41,41,52,52,52,41,41,41,52,39,41,39,52,52,41,41,41,52,52,52,41,41,41,52,52,52,41,52,41,52,52,52,39,52,52,41,39,52,52,41,41,52,52,41,41,52,52,39,41,52,41,52,41,41,52,52,41,52,52,52,52,41,41,41,52,39,41,41,52,41,41,52,52,52,52,41,41,39,52,41,52,39,52,52,52,52,52,41,41,41,39,41,52,41,52,41,41,52,52,52,52,52,52,41,52,52,41,41,39,52,41,52,41,52,39,52,52,41,52,41,41,39,41,41,41,41,52,52,41,41,52,41,41,52,52,52,41,41,52,41,39,41,52,41,52,41,41,39,52,41,41,52,52,52,39,52,41,52,41,41,52,52,41,41,41,52,52,52,39,39,52,52,52,52,52,52,41,52,52,41,41,52,39,52,52,52,39,52,52,41,52,41,52,52,52,41,52,52,39,52,52,52,52,52,39,52,41,41,41,41,52,52,41,52,52,52,41,41,52,52,41,52,52,52,39,41,39,39,52,52,52,41,52,52,52,52,39,52,52,52,41,39,39,52,52,52,52,52,52,41,52,41,41,52,52,41,41,52,52,52,41,52,39,41,39,41,52,52,52,52,41,52,52,52,41,52,41,52,52,52,52,52,41,41,52,41,52,39,41,41,39,52,41,39,41,41,52,52,41,39,41,52,52,41,41,52,41,52,52,41,52,41,52,41,41,52,41,52,52,52,41,41,39,52,39,52,52,52,52,39,52,41,52,52,52,52,41,52,41,52,41,52,39,39,52,52,41,52,52,52,41,52,52,52,52,41,41,52,52,41,52,41,52,52,41,52,41,52,41,52,52,41,52,52,39,39,41,52,52,41,52,52,41,52,39,52,41,41,41,52,52,52,52,52,52,39,52,52,41,39,39,41,52,52,52,52,52,52,41,39,52,41,52,52,52,52,41,41,52,41,52,52,41,52,52,39,52,52,52,39,39,41,41,52,52,52,52,52,41,41,52,52,41,41,52,52,41,52,52,41,41,41,41,41,41,41,52,52,41,52,41,52,52,409,409,409,409,401,401,409,401,409,409,401,401,401,401,409,409,401,409,401,401,409,401,409,409,401,401,401,401,409,401,409,409,401,401,409,409,401,409,401,401,409,401,409,409,409,401,409,409,409,409,409,409,401,401,409,409,409,409,409,401,409,409,401,409],height:18,id:1,name:"Background",opacity:1,type:"tilelayer",visible:!0,width:32,x:0,y:0},{data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,188,189,0,193,194,0,0,0,0,191,0,0,0,0,0,0,0,0,0,0,0,0,0,193,194,0,0,0,0,0,188,189,213,214,0,218,219,0,0,0,0,216,0,0,0,0,0,0,0,0,0,0,0,0,0,218,219,0,0,0,0,0,213,214,667,667,667,683,667,675,675,667,667,683,675,667,668,0,0,0,0,0,0,666,667,667,667,683,667,667,667,667,667,675,667,667,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,683,667,675,668,0,0,0,127,128,130,130,130,130,130,130,130,130,130,130,130,130,130,130,127,128,0,0,0,666,683,675,667,0,0,0,0,0,0,0,152,153,0,0,0,0,0,0,0,0,0,0,0,0,0,0,152,153,0,0,0,0,0,0,0,0,0,196,0,0,0,0,132,133,191,0,0,0,0,0,0,0,0,0,0,0,0,0,132,133,0,0,0,0,0,0,0,0,0,221,0,0,0,0,157,158,216,0,0,0,0,0,0,0,0,0,0,0,0,0,157,158,0,0,0,0,0,0,0,127,128,130,130,130,130,130,130,130,130,130,127,128,0,0,0,0,0,0,127,128,130,130,130,130,130,130,130,130,130,127,128,152,153,0,0,0,0,0,0,0,0,0,152,153,0,0,0,0,0,0,152,153,0,0,0,0,0,0,0,0,0,152,153,188,189,0,0,0,196,0,0,0,0,0,132,133,0,0,0,196,0,0,132,133,0,0,0,0,0,0,0,191,0,188,189,213,214,0,0,0,221,0,0,0,0,0,157,158,0,0,0,221,0,0,157,158,0,0,0,0,0,0,0,216,0,213,214,335,336,335,335,335,336,335,338,335,336,335,336,336,336,336,336,336,335,336,338,335,338,335,335,335,336,338,336,338,338,335,338,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],height:18,id:3,name:"Platforms",opacity:1,type:"tilelayer",visible:!0,width:32,x:0,y:0}],Q=10,Z=34,V="orthogonal",ee="right-down",te="1.8.5",ie=16,ne=[{firstgid:1,source:"../tilesets/Scaffolding & bg.json"},{firstgid:301,source:"../tilesets/Cave.json"}],ae=16,oe="map",se="1.8",re=32;var ge={compressionlevel:z,height:J,infinite:q,layers:G,nextlayerid:Q,nextobjectid:Z,orientation:V,renderorder:ee,tiledversion:te,tileheight:ie,tilesets:ne,tilewidth:ae,type:oe,version:se,width:re};const he=0,ce={height:1,orientation:"orthogonal",width:1},me=0,pe="Characters",le=0,de=33,ue="1.8.5",ye=16,we=[{id:0,image:"../images/Mini Pixel Pack 1/5 - Ant/Run (16 x 16).png",imageheight:16,imagewidth:32,properties:[{name:"action",type:"string",value:"moving"},{name:"character",type:"string",value:"Ant"}]},{id:1,image:"../images/Mini Pixel Pack 1/5 - Ant/Back_view (16 x 16).png",imageheight:16,imagewidth:16,properties:[{name:"action",type:"string",value:"back"},{name:"character",type:"string",value:"Ant"}]},{id:2,image:"../images/Mini Pixel Pack 1/5 - Ant/Blink (16 x 16).png",imageheight:16,imagewidth:16,properties:[{name:"action",type:"string",value:"blink"},{name:"character",type:"string",value:"Ant"}]},{id:3,image:"../images/Mini Pixel Pack 1/5 - Ant/Hurt (16 x 16).png",imageheight:16,imagewidth:32,properties:[{name:"action",type:"string",value:"hurt"},{name:"character",type:"string",value:"Ant"}]},{id:4,image:"../images/Mini Pixel Pack 1/5 - Ant/Idle (16 x 16).png",imageheight:16,imagewidth:16,properties:[{name:"action",type:"string",value:"idle"},{name:"character",type:"string",value:"Ant"}]},{id:5,image:"../images/Mini Pixel Pack 1/5 - Ant/Jump (16 x 16).png",imageheight:16,imagewidth:16,properties:[{name:"action",type:"string",value:"jump"},{name:"character",type:"string",value:"Ant"}]},{id:6,image:"../images/Mini Pixel Pack 1/4 - Binny/Back_view (16 x 16).png",imageheight:16,imagewidth:16,properties:[{name:"action",type:"string",value:"back"},{name:"character",type:"string",value:"Binny"}]},{id:7,image:"../images/Mini Pixel Pack 1/4 - Binny/Blink (16 x 16).png",imageheight:16,imagewidth:16,properties:[{name:"action",type:"string",value:"blink"},{name:"character",type:"string",value:"Binny"}]},{id:8,image:"../images/Mini Pixel Pack 1/4 - Binny/Idle (16 x 16).png",imageheight:16,imagewidth:16,properties:[{name:"action",type:"string",value:"idle"},{name:"character",type:"string",value:"Binny"}]},{id:9,image:"../images/Mini Pixel Pack 1/4 - Binny/Jump (16 x 16).png",imageheight:16,imagewidth:16,properties:[{name:"action",type:"string",value:"jump"},{name:"character",type:"string",value:"Binny"}]},{id:10,image:"../images/Mini Pixel Pack 1/4 - Binny/Moving (16 x 16).png",imageheight:16,imagewidth:32,properties:[{name:"action",type:"string",value:"moving"},{name:"character",type:"string",value:"Binny"}]},{id:11,image:"../images/Mini Pixel Pack 1/4 - Binny/Protected (16 x 16).png",imageheight:16,imagewidth:16,properties:[{name:"action",type:"string",value:"hurt"},{name:"character",type:"string",value:"Binny"}]},{id:12,image:"../images/Sprite Pack 1/5 - Devo the Devil/Standing (16 x 16).png",imageheight:16,imagewidth:16,properties:[{name:"action",type:"string",value:"idle"},{name:"character",type:"string",value:"Devo"}]},{id:13,image:"../images/Sprite Pack 1/5 - Devo the Devil/Falling (16 x 16).png",imageheight:16,imagewidth:16,properties:[{name:"action",type:"string",value:""},{name:"character",type:"string",value:"Devo"}]},{id:14,image:"../images/Sprite Pack 1/5 - Devo the Devil/Hurt (16 x 16).png",imageheight:16,imagewidth:16,properties:[{name:"action",type:"string",value:"hurt"},{name:"character",type:"string",value:"Devo"}]},{id:15,image:"../images/Sprite Pack 1/5 - Devo the Devil/Jumping (16 x 16).png",imageheight:16,imagewidth:16,properties:[{name:"action",type:"string",value:"jump"},{name:"character",type:"string",value:"Devo"}]},{id:16,image:"../images/Sprite Pack 1/5 - Devo the Devil/Running (16 x 16).png",imageheight:16,imagewidth:64,properties:[{name:"action",type:"string",value:"moving"},{name:"character",type:"string",value:"Devo"}]},{id:17,image:"../images/Sprite Pack 1/11 - Spikey Bub/Idle (16 x 16).png",imageheight:16,imagewidth:32,properties:[{name:"action",type:"string",value:"idle"},{name:"character",type:"string",value:"Bumpy"}]},{id:18,image:"../images/Sprite Pack 1/11 - Spikey Bub/Protection (16 x 16).png",imageheight:16,imagewidth:16,properties:[{name:"action",type:"string",value:""},{name:"character",type:"string",value:"Bumpy"}]},{id:19,image:"../images/Sprite Pack 1/11 - Spikey Bub/Running (16 x 16).png",imageheight:16,imagewidth:96,properties:[{name:"action",type:"string",value:"moving"},{name:"character",type:"string",value:"Bumpy"}]},{id:20,image:"../images/Sprite Pack 1/11 - Spikey Bub/Hurt (16 x 16).png",imageheight:16,imagewidth:16,properties:[{name:"action",type:"string",value:"hurt"},{name:"character",type:"string",value:"Bumpy"}]},{id:21,image:"../images/Mini FX, Items & UI/Effects/Dust (16 x 16).png",imageheight:16,imagewidth:96,type:"dust"},{id:22,image:"../images/Mini FX, Items & UI/Effects/Explosion_Poof (16 x 16).png",imageheight:16,imagewidth:128,type:"explosion"},{id:23,image:"../images/Mini FX, Items & UI/Mini UI/Health_Indicator_White_Outline (8 x 8).png",imageheight:8,imagewidth:16,type:"health"},{id:24,image:"../images/Sprite Pack 4/1 - Agent_Mike_Bullet (16 x 16).png",imageheight:16,imagewidth:16,type:"bullet"},{id:25,image:"../images/Mini FX, Items & UI/Common Pick-ups/Coin (16 x 16).png",imageheight:16,imagewidth:64,type:"big coin"},{id:26,image:"../images/Mini FX, Items & UI/Effects/Yellow_Sparkle (16 x 16).png",imageheight:16,imagewidth:80},{id:27,image:"../images/Sprite Pack 1/4 - Bushly/Hurt (16 x 16).png",imageheight:16,imagewidth:16,properties:[{name:"action",type:"string",value:"hurt"},{name:"character",type:"string",value:"Bushly"}]},{id:28,image:"../images/Sprite Pack 1/4 - Bushly/Idle (16 x 16).png",imageheight:16,imagewidth:48,properties:[{name:"action",type:"string",value:"idle"},{name:"character",type:"string",value:"Bushly"}]},{id:29,image:"../images/Sprite Pack 1/4 - Bushly/Jumping (16 x 16).png",imageheight:16,imagewidth:16,properties:[{name:"action",type:"string",value:"jump"},{name:"character",type:"string",value:"Bushly"}]},{id:30,image:"../images/Sprite Pack 1/4 - Bushly/Running (16 x 16).png",imageheight:16,imagewidth:96,properties:[{name:"action",type:"string",value:"moving"},{name:"character",type:"string",value:"Bushly"}]},{id:31,image:"../images/Mini FX, Items & UI/Common Pick-ups/Small_Coin (16 x 16).png",imageheight:16,imagewidth:64,type:"small coin"},{id:32,image:"../images/Mini FX, Items & UI/Common Pick-ups/Heart_Spin (16 x 16).png",imageheight:16,imagewidth:64,type:"heart"}],ve=128,fe="tileset",xe="1.8";var be={columns:he,grid:ce,margin:me,name:pe,spacing:le,tilecount:de,tiledversion:ue,tileheight:ye,tiles:we,tilewidth:ve,type:fe,version:xe};const Pe=7,Be="../images/Mini FX, Items & UI/Mini UI/Timer_Coin_Numbers_Outlined (8 x 8).png",ke=16,Me=56,Se=0,Ie="Points",Te=0,je=14,Ee="1.8.5",$e=8,Fe=[{id:0,type:"clock"},{id:2,type:"0"},{id:3,type:"1"},{id:4,type:"2"},{id:5,type:"3"},{id:6,type:"4"},{id:7,type:"coin"},{id:9,type:"5"},{id:10,type:"6"},{id:11,type:"7"},{id:12,type:"8"},{id:13,type:"9"}],Le=8,Ce="tileset",Ae="1.8";var Re={columns:Pe,image:Be,imageheight:ke,imagewidth:Me,margin:Se,name:Ie,spacing:Te,tilecount:je,tiledversion:Ee,tileheight:$e,tiles:Fe,tilewidth:Le,type:Ce,version:Ae};const F=(e,t,n,h)=>({x:e,y:t,oldY:t,height:h,width:n,getBottom(){return this.y+this.height},getCenterX(){return this.x+this.width*.5},getCenterY(){return this.y+this.height*.5},getLeft(){return this.x},getRight(){return this.x+this.width},getTop(){return this.y},getOldBottom(){return this.old_y+this.height},getOldTop(){return this.old_y},setBottom(a){this.y=a-this.height},setLeft(a){this.x=a},setRight(a){this.x=a-this.width},setTop(a){this.y=a},moveX(a){this.x+=a},moveY(a){this.old_y=this.y,this.y+=a}}),A=async(e,t="json")=>{debugger;const n=await fetch(new URL(e.replace("../","/"),import.meta.url)),h=a=>new Promise(async(i,c)=>{const s=await n.blob(),r=document.createElement("img"),y=URL.createObjectURL(s);return r.src=y,r.addEventListener("load",()=>i(r)),r});switch(t){case"json":return await n.json();case"img":return await h()}},R=(e,t,n,h)=>(h=h??n,[e%t*n,Math.floor(e/t)*h]);function T(e,t){return!(e.getLeft()>t.getRight()||e.getTop()>t.getBottom()||e.getRight()<t.getLeft()||e.getBottom()<t.getTop())}const E={top:(e,t)=>e.getBottom()>t.getTop()&&e.getTop()<t.getTop(),bottom:(e,t)=>e.getTop()<t.getBottom()&&e.getBottom()>t.getBottom(),left:(e,t)=>e.getLeft()<t.getRight()&&e.getCenterY()>t.getTop()&&e.getCenterY()<t.getBottom()&&e.getRight()>t.getRight(),right:(e,t)=>e.getRight()>t.getLeft()&&e.getCenterY()>t.getTop()&&e.getCenterY()<t.getBottom()&&e.getLeft()<t.getLeft()};function De(e,t){return E.top(e,t)?(e.setBottom(t.getTop()),e.grounded=!0,!0):E.bottom(e,t)?(e.setTop(t.getBottom()),e.velocity.y=0,!0):E.left(e,t)?(e.setLeft(t.getRight()),e.velocity.x=0,!0):E.right(e,t)?(e.setRight(t.getLeft()),e.velocity.x=0,!0):!1}const U=async function(e){return e.source&&Object.assign(e,{...await A(e.source)}),e.image&&Object.assign(e,{img:await A(e.image,"img")}),e},O=async function(e){const t=await Promise.all(e.tilesets.map(U)),n=s=>t.find(r=>s>=r.firstgid&&s<=r.firstgid+r.tilecount),h=e.layers.filter(s=>s.type=="objectgroup").reduce((s,r)=>({...s,[r.name]:r.objects?.map(y=>({...y,...y.properties?.reduce((p,m)=>({...p,[m.name]:m.value}),{})}))}),{}),a=e.layers.filter(s=>s.type=="tilelayer").map(s=>s.data.map((r,y)=>{if(r){const p=n(r),[m,l]=R(r-p.firstgid,p.columns,p.tileheight,p.tilewidth),[w,d]=R(y,s.width,e.tileheight,e.tilewidth);return{type:p.tiles.find(v=>v.id==r-p.firstgid)?.type,img:p.img,sx:m,sy:l,sh:p.tileheight,sw:p.tilewidth,...F(w,d,e.tileheight,e.tilewidth)}}})),i=a.flatMap(s=>s.filter(r=>r?.type));let c={};return{left:0,right:e.tilewidth*e.width,top:0,bottom:e.tileheight*e.height,items:[],...e,layers:a,objects:h,tilesets:t,collideWithEntity(s){return this.left>=s.getLeft()&&s.setLeft(this.left),this.right<=s.getRight()&&s.setRight(this.right),this.top>=s.getTop()&&s.setTop(this.top),this.bottom<=s.getBottom()&&s.setBottom(this.bottom),i.filter(r=>T(s,r)).filter(r=>De(s,r))},getSpawnPoint(s){const r=h.positions.filter(l=>l.spanwPoint==s&&l.id!=c?.[s]),{x:y,y:p,id:m}=r[Math.floor(Math.random()*r.length)];return c[s]=m,{x:y,y:p}}}},_e=1.2,D=.85,H=async function(e){const t=await Promise.all(e.tiles.map(async n=>({...n,...n.properties?.reduce((h,a)=>({...h,[a.name]:a.value}),{}),img:await A(n.image,"img")})));return{getCharacter(n){return t.filter(h=>h.character==n).reduce((h,a)=>({...h,[a.action]:$(a.img)}),{})},getType(n){return t.find(h=>h.type==n)}}},$=function(e,t=20){return{counter:0,framesNb:e.width/e.height,selectedFrame:0,delay:t,cycles:0,getFrame(){return[e,this.selectedFrame*e.height,0,e.height,e.height]},animate(){this.counter++,this.counter>=this.delay&&(this.selectedFrame=(this.selectedFrame+1)%this.framesNb,this.counter=0,this.cycles++)}}},_=({tiles:e,x:t,y:n,reversed:h=!1,moveForce:a=.5,id:i})=>({...F(t,n,16,16),tiles:e,state:"idle",direction:1,moveForce:a,jumpForce:35,reversed:h,velocity:{x:0,y:0},grounded:!1,id:i,moveLeft(){this.velocity.x-=this.moveForce},moveRight(){this.velocity.x+=this.moveForce},jump(){this.grounded&&(this.grounded=!1,this.velocity.y-=this.jumpForce)},update(){this.grounded?Math.abs(this.velocity.x)>.1?this.state="moving":Math.abs(this.velocity.x)<.1&&(this.state="idle"):this.state="jump",this.velocity.x*=D,this.velocity.y+=_e,this.velocity.y*=D,this.x+=this.velocity.x,this.moveY(this.velocity.y),this.direction=this.velocity.x>0?1:-1}}),Ue=function(e,t){return{img:t,...F(e.x,e.y,t.width,t.height),width:t.width,height:t.height,direction:e.direction,update(){this.moveX(4*this.direction)}}},C=function(e,t,n={}){return()=>({img:$(e),type:t,...n})},Oe=async function(e,t){const n=await H(be),h=n.getCharacter("Ant");n.getCharacter("Binny");const a=n.getCharacter("Bumpy"),i=n.getCharacter("Devo"),c=n.getCharacter("Bushly"),s=n.getType("explosion").img,r=n.getType("health").img,y=n.getType("dust").img,p=n.getType("bullet").img,m=n.getType("small coin").img,l=n.getType("big coin").img,w=n.getType("heart").img,d=await U(Re),b=[C(l,"coin",{amount:10}),C(m,"coin",{amount:5}),C(w,"heart")],v=await O(ge),g=_({tiles:h,x:32,y:15*16});g.points=0,g.health=3,g.maxHealth=5,g.dust=$(y,4),g.bullets=[];const k=[[a,!0],[i,!0],[c,!1]],B=[];let M=0,S=0;const j=o=>{const[P,f]=k[Math.floor(Math.random()*k.length)],{x:I,y:L}=o.getSpawnPoint("enemy"),X=M%2?1:-1;M++;const Y=_({tiles:P,x:I,y:L,reversed:f,moveForce:.2,id:M,direction:X});B.push(Y)},u=o=>{const P=()=>o.direction=o.direction*-1,f=()=>o.setBottom(48);switch(o?.layer!=o.getBottom()&&o.grounded&&(Math.random()>.5&&P(),o.layer=o.getBottom()),(o.getRight()>=v.right||o.getLeft()<=v.left)&&(o.getBottom()==16*16&&f(),P()),o.direction){case-1:return o.moveLeft();case 1:return o.moveRight()}},x=()=>{g.state!="hurt"&&(g.update(),v.collideWithEntity(g),t.left.active&&g.moveLeft(),t.right.active&&g.moveRight(),t.jump.once&&g.jump(),t.shoot.once&&g.bullets.push(Ue(g,p)))};return e.createMapBuffer(v,0),e.createMapBuffer(v,1),{set(){},render(){e.drawMap(v),B.forEach((o,P)=>{e.drawEntity(o),o?.explosion&&(o.explosion.animate(),e.drawFrame(o.explosion.getFrame(),[o.x,o.y,16,16]))}),e.drawEntity(g),g.state=="moving"&&(g.dust.animate(),e.drawFrame(g.dust.getFrame(),[g.x-g.direction*g.width,g.y,16,16],g.direction)),g.state=="idle"&&(g.dust.selectedFrame=0),e.drawPlayerHealth(r,g),e.drawPlayerPoints(d,g),g.bullets.forEach(o=>e.drawBullet(o)),v.items.forEach(o=>e.drawItem(o))},update(){S++,S>=180&&B.length<10&&(S=0,j(v)),B.some(o=>T(o,g))||(g.lastEnemyHit=null),g.state=="hurt"&&g.tiles.hurt.cycles>=3&&(g.tiles.hurt.cycles=0,g.state="idle"),v.items.forEach((o,P)=>{T(o,g)&&(o.type=="coin"&&(g.points+=o.amount,g.points=g.points),o.type=="heart"&&g.health<g.maxHealth&&g.health++,v.items.splice(P,1)),o.img.delay=20-o.img.cycles,o.img.delay<=-10&&v.items.splice(P,1)}),B.forEach((o,P)=>{if(T(o,g)&&o.state!="hurt"&&g.lastEnemyHit===null&&(g.health--,g.lastEnemyHit=P,g.state="hurt",g.velocity.x=0,g.velocity.y=0),g.bullets.forEach((f,I)=>{T(f,o)&&(g.bullets.splice(I,1),o.state="hurt")}),o.state!="hurt"&&(u(o),o.update()),v.collideWithEntity(o),o.state=="hurt"&&!o?.explosion&&(o.explosion=$(s,4)),o?.explosion&&o.explosion.selectedFrame>=o.explosion.framesNb-1){B.splice(P,1);const f=b[Math.floor(Math.random()*b.length)],{x:I,y:L}=v.getSpawnPoint("item");v.items.push({...f(),...F(I,L,16,16)});return}}),g.bullets.forEach(o=>o.update()),x()},changeState(){return t.pause.once?["pause"]:!1}}},He=async e=>{const n=(await navigator.keyboard.getLayoutMap()).get("KeyA")=="a";let h=!1,a=navigator.userAgentData.mobile;const i={up:[12],down:[13],left:[14],right:[15],enter:[0],pause:[9],jump:[0],shoot:[2]},c={up:[n?"KeyZ":"KeyW","ArrowUp"],down:["KeyS","ArrowDown"],left:[n?"KeyQ":"KeyA","ArrowLeft"],right:["KeyD","ArrowRight"],enter:["Space","Enter","NumpadEnter"],pause:["KeyP"],jump:["KeyL"],shoot:[n?"KeyM":"Semicolon"]};window.addEventListener("gamepadconnected",m=>{console.log("gamepad deteted"),h=!0,setInterval(()=>{navigator.getGamepads()[0].buttons.forEach(({pressed:l},w)=>{Object.entries(i).filter(([d,b])=>b.includes(w)).forEach(([d,b])=>{r[d]?.getInput(l)})})},10)}),window.addEventListener("gamepaddisconnected",m=>{h=!1,gamepad=null});const s=function(){return{active:!1,down:!1,get once(){return this.active?(this.active=!1,!0):!1},getInput(m){this.down!=m&&(this.active=m),this.down=m}}},r=Object.keys(c).reduce((m,l)=>({...m,[l]:s()}),{}),y=m=>{m.preventDefault();const l=m.type=="keydown",w=Object.entries(c).find(([d,b])=>b.includes(m.code))?.[0];w&&r[w].getInput(l)};document.addEventListener("keydown",y),document.addEventListener("keyup",y);const p=m=>Object.entries(e).find(l=>l[0]==m)[1];return{inputs(){const m=a?["touch"]:["keyboard"];return h&&m.push("controller"),m},...r,get:m=>c[p(m)].active,set:(m,l)=>c[p(m)].active=l}},Ke=function(e,t){return{set(){},render(){},update(){},changeState(){if(t.pause.once)return["run"]}}},Xe=-1,Ye=18,Ne=!1,We=[{data:[37,41,37,37,41,37,39,52,41,52,41,41,52,37,39,39,41,41,41,52,52,41,52,52,52,52,39,52,52,52,37,41,52,52,39,41,41,52,37,52,41,52,52,37,52,37,37,41,41,41,52,37,41,52,41,52,41,41,37,41,37,52,41,52,39,37,41,52,41,52,52,52,52,41,52,52,41,41,39,52,52,39,52,52,52,41,41,41,41,52,52,52,52,39,41,39,41,37,37,52,41,41,41,41,52,52,41,52,39,39,41,52,52,52,52,52,41,41,37,52,41,41,52,37,41,52,52,52,41,41,52,52,52,52,52,37,52,37,41,52,41,52,52,37,52,52,52,37,39,41,37,41,52,41,39,52,41,52,52,52,52,41,52,52,37,37,37,52,52,39,52,37,52,41,41,41,52,39,41,52,52,37,41,39,41,41,41,41,41,52,52,52,52,41,41,52,39,41,52,52,39,52,39,52,52,41,52,52,39,52,52,52,41,52,39,52,41,39,52,52,52,52,52,52,39,39,52,52,41,52,52,41,41,52,39,39,41,52,39,52,41,52,52,52,52,52,52,37,52,37,39,37,37,52,52,52,52,52,52,41,39,37,52,37,52,41,52,52,52,39,52,39,41,39,41,52,39,39,52,52,39,37,41,52,41,52,41,52,52,52,37,41,37,52,37,41,52,41,52,52,52,41,37,41,37,52,41,39,52,52,39,52,37,41,52,37,41,52,52,41,41,52,52,52,52,52,52,52,52,39,52,37,37,41,41,52,52,52,52,52,52,52,52,52,52,52,52,41,41,41,52,52,37,52,41,52,39,52,52,52,52,39,37,52,39,37,52,39,39,52,52,41,52,39,37,52,52,52,52,52,41,41,52,52,52,41,52,52,41,52,41,52,41,52,52,52,52,52,52,41,52,41,52,41,41,41,39,52,39,52,41,52,52,52,52,41,52,52,41,52,41,39,37,52,52,52,41,41,52,52,39,39,52,41,41,41,41,41,37,37,41,37,52,52,52,39,41,37,52,41,41,41,52,52,52,52,52,41,37,39,52,37,52,41,52,41,37,39,41,39,52,52,41,52,52,52,39,52,52,41,37,39,52,41,52,52,52,52,37,41,41,41,52,52,52,52,41,41,52,52,41,52,41,52,52,52,52,52,41,41,52,52,41,41,52,52,52,52,37,52,52,39,37,52,37,52,41,52,52,39,41,41,41,41,37,52,52,52,52,52,52,41,52,37,401,401,417,417,409,417,417,401,401,417,401,409,401,417,401,409,401,409,401,401,401,417,409,401,417,401,409,417,417,401,401,401],height:18,id:1,name:"Background",opacity:1,type:"tilelayer",visible:!0,width:32,x:0,y:0},{data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,501,667,668,0,0,0,666,668,0,0,501,667,668,0,0,0,666,668,0,0,666,502,668,0,0,0,0,0,0,0,0,0,766,0,0,670,0,733,0,0,733,0,766,0,0,670,0,733,0,0,733,0,0,766,0,0,0,0,0,0,0,0,0,0,470,667,668,0,0,766,0,0,766,0,470,667,668,0,0,766,0,0,766,0,0,766,0,0,0,0,0,0,0,0,0,0,766,0,0,733,0,799,0,0,799,0,766,0,0,670,0,799,0,0,799,0,0,766,0,0,0,0,0,0,0,0,0,0,799,0,0,799,0,0,666,668,0,0,569,667,668,0,0,0,666,668,0,0,0,799,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,501,667,668,0,0,501,667,668,0,0,0,666,668,0,0,501,667,668,0,0,0,0,0,0,0,0,0,0,0,0,0,0,766,0,0,670,0,766,0,0,670,0,733,0,0,733,0,766,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,470,667,668,0,0,470,667,668,0,0,766,0,0,766,0,569,667,438,0,0,0,0,0,0,0,0,0,0,0,0,0,0,766,0,0,670,0,766,0,0,733,0,799,0,0,799,0,0,0,766,0,0,0,0,0,0,0,0,0,0,0,0,0,0,569,667,668,0,0,799,0,0,799,0,0,666,668,0,0,666,667,570,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,127,128,130,130,130,130,130,130,130,130,130,130,130,127,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,152,153,0,0,0,0,0,0,0,0,0,0,0,152,153,0,0,0,0,0,0,0,0,0,0,0,0,0,0,193,194,0,132,133,0,191,0,0,0,0,196,0,0,0,0,132,133,0,188,189,0,0,0,0,0,0,0,0,0,0,0,218,219,0,157,158,0,216,0,0,0,0,221,0,0,0,0,157,158,0,213,214,0,338,338,335,338,338,338,335,335,336,335,338,335,338,336,336,336,335,338,335,335,335,335,338,335,338,338,335,336,335,336,336,335],height:18,id:3,name:"Platforms",opacity:1,type:"tilelayer",visible:!0,width:32,x:0,y:0},{draworder:"topdown",id:8,name:"ui",objects:[{height:32,id:3,name:"play",properties:[{name:"order",type:"int",value:0}],rotation:0,type:"menu",visible:!0,width:96,x:46.3333333333333,y:111},{height:32,id:4,name:"controller",properties:[{name:"order",type:"int",value:1}],rotation:0,type:"menu",visible:!0,width:96,x:48,y:160},{height:32,id:5,name:"character",properties:[{name:"order",type:"int",value:2}],rotation:0,type:"menu",visible:!0,width:96,x:48,y:208},{height:79.6363636363636,id:7,name:"character",rotation:0,type:"preview",visible:!0,width:79.6363636363636,x:416,y:16.3636363636364},{height:32,id:9,name:"controller",rotation:0,type:"right",visible:!0,width:32,x:160,y:160},{height:32,id:10,name:"controller",rotation:0,type:"left",visible:!0,width:32,x:0,y:160},{height:32,id:11,name:"character",rotation:0,type:"left",visible:!0,width:32,x:0,y:208},{height:32,id:12,name:"character",rotation:0,type:"right",visible:!0,width:32,x:160,y:208}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],ze=9,Je=13,qe="orthogonal",Ge="right-down",Qe="1.8.5",Ze=16,Ve=[{firstgid:1,source:"../tilesets/Scaffolding & bg.json"},{firstgid:301,source:"../tilesets/Cave.json"}],et=16,tt="map",it="1.8",nt=32;var at={compressionlevel:Xe,height:Ye,infinite:Ne,layers:We,nextlayerid:ze,nextobjectid:Je,orientation:qe,renderorder:Ge,tiledversion:Qe,tileheight:Ze,tilesets:Ve,tilewidth:et,type:tt,version:it,width:nt};const ot=0,st={height:1,orientation:"orthogonal",width:1},rt=0,gt="UI",ht=0,ct=13,mt="1.8.5",pt=44,lt=[{id:6,image:"../images/ui/button.png",imageheight:32,imagewidth:96,type:"default"},{id:8,image:"../images/ui/button_selected.png",imageheight:32,imagewidth:96,type:"selected"},{id:9,image:"../images/ui/Start.png",imageheight:7,imagewidth:18,type:"start"},{id:10,image:"../images/ui/CharacterPreview.png",imageheight:44,imagewidth:44,type:"charcaterPreview"},{id:11,image:"../images/ui/controller.png",imageheight:8,imagewidth:34,type:"controller"},{id:12,image:"../images/ui/keyboard.png",imageheight:8,imagewidth:32,type:"keyboard"},{id:13,image:"../images/ui/Touch.png",imageheight:8,imagewidth:21,type:"touch"},{id:14,image:"../images/ui/arrow.png",imageheight:14,imagewidth:14,type:"arrow"},{id:15,image:"../images/ui/Ant.png",imageheight:8,imagewidth:10,type:"ant"},{id:16,image:"../images/ui/Binny.png",imageheight:8,imagewidth:18,type:"binny"},{id:17,image:"../images/ui/dpad.png",imageheight:26,imagewidth:130,type:"dpad"},{id:18,image:"../images/ui/buttonB.png",imageheight:16,imagewidth:64,type:"b"},{id:19,image:"../images/ui/buttonA.png",imageheight:16,imagewidth:64,type:"a"}],dt=130,ut="tileset",yt="1.8";var wt={columns:ot,grid:st,margin:rt,name:gt,spacing:ht,tilecount:ct,tiledversion:mt,tileheight:pt,tiles:lt,tilewidth:dt,type:ut,version:yt};const vt=async function(e,t){const n=await H(wt),h=n.getType("default").img,a=n.getType("selected").img,i=n.getType("start").img,c=n.getType("keyboard").img,s=n.getType("controller").img,r=n.getType("touch").img,y=n.getType("ant").img,p=n.getType("binny").img,m=n.getType("charcaterPreview").img,l=n.getType("arrow").img,w=await O(at);e.createMapBuffer(w,0),e.createMapBuffer(w,1);let d=0;const b=[0,0,0],v={keyboard:c,touch:r,controller:s},g=()=>Object.entries(v).filter(([u,x])=>t.inputs().includes(u)).map(([u,x])=>x),k=[[i],[],[y,p]],B=w.objects.ui.filter(u=>u.type=="menu").sort((u,x)=>u.order-x.order),M=w.objects.ui.find(u=>u.type=="preview"),S=(u,x)=>(u+1)%x.length,j=(u,x)=>u===0?x.length-1:u-1;return{set(){},render(){e.drawMap(w),B.forEach((u,x)=>{const o=d==x?a:h;e.draw(o,0,0,o.width,o.height,u.x,u.y,u.width,u.height);const P=k[x][b[x]];e.drawCentered(P,u,2),["character","controller"].includes(u.name)&&d==x&&w.objects.ui.filter(f=>f.name==u.name&&f.type!="menu").forEach(f=>{f.name=="controller"&&k[1].length==1||e.drawFrame([l,0,0,l.width,l.height],[f.x,f.y,f.width,f.height],f.type=="right"?1:0)})}),e.draw(m,0,0,m.width,m.height,M.x,M.y,M.width,M.height)},update(){k[1]=g(),t.down.once&&(d=S(d,B)),t.up.once&&(d=j(d,B)),t.left.once&&(b[d]=S(b[d],k[d])),t.right.once&&(b[d]=j(b[d],k[d]))},changeState(){return t.enter.once&&d==0?["run"]:!1}}},ft=e=>{const t=K(e),n=t.canvas;document.body.append(n);const h=()=>{const a=document.documentElement.clientWidth/t.canvas.width,i=document.documentElement.clientHeight/t.canvas.height,c=a<i?a:i;t.canvas.style.height=Math.floor(t.canvas.height*c)+"px",t.canvas.style.width=Math.floor(t.canvas.width*c)+"px"};return window.addEventListener("resize",h),h(),t},K=e=>{const n=document.createElement("canvas").getContext("2d",{alpha:!0});return n.canvas.height=e,n.canvas.width=16/9*e,n.imageSmoothingEnabled=!1,n.canvas.style["image-rendering"]="pixelated",n},xt=function(e,t=1){const n=ft(e*t),h=(i,c,s,r,y,p,m,l,w,d=1)=>n.drawImage(i,c,s,r,y,p*t,m*t,l*t*d,w*t*d),a=(i,c,s,r,y,p,m,l,w)=>{n.scale(-1,1),h(i,c,s,r,y,-Math.floor(p+l),Math.floor(m),l,w),n.scale(-1,1)};return{ctx:n,draw:h,drawCentered(i,c,s){h(i,0,0,i.width,i.height,c.x+c.width/2-i.width*s/2,c.y+c.height/2-i.height*s/2,i.width*s,i.height*s)},drawFrame(i,c,s=1){s===1?h(...i,...c):a(...i,...c)},drawEntity(i){const c=i.tiles[i.state]??i.tiles.idle;c.animate();const s=c.getFrame();this.drawFrame(s,[i.x,i.y,16,16],i.direction*(i.reversed?-1:1))},drawMap(i){i?.buffers.forEach(c=>n.drawImage(c.canvas,0,0))},createMapBuffer(i,c){i?.buffers||(i.buffers=[]),i.buffers?.[c]||(i.buffers[c]=K(e*t)),i.layers[c].forEach(r=>{r&&i.buffers[c].drawImage(r.img,r.sx,r.sy,r.sh,r.sw,r.x,r.y,r.height,r.width)})},drawPlayerHealth(i,{health:c,maxHealth:s}){for(let r=0;r<s;r++)n.drawImage(i,r<c?0:8,0,8,8,r*16,268,16,16)},drawPlayerPoints(i,{points:c=0}){const s=m=>R(i.tiles.find(l=>l.type==m).id,i.columns,i.tilewidth,i.tileheight),r=s("coin"),y=c.toString(),p=new Array(6-y.length).fill(0).join("")+y;for(let m=0;m<p.length;m++)h(i.img,...s(p[m]),i.tilewidth,i.tileheight,(25+m)*16,268,16,16);h(i.img,...r,i.tilewidth,i.tileheight,25*16,268,16,16)},drawBullet(i){h(i.img,0,0,i.width,i.height,i.x,i.y,i.width,i.height)},drawItem(i){i.img.animate();const c=i.img.getFrame();this.drawFrame(c,[i.x,i.y,16,16])}}};(async function(){const e=await He();document.addEventListener("keydown",()=>console.log(e.inputs()));const t=xt(288),n=await Oe(t,e),h=Ke(t,e),a=await vt(t,e),i=new W({run:n,pause:h,title:a});i.setState(["title"]),i.start()})();
